import{_ as le,f as m,l as g,e as h,j as ae,m as oe,c as i,d as q,a as s,g as R,h as f,p as ne,v as ie,t as p,u as b,F as _,i as V,b as w,q as re,s as ue,o,x as j}from"./index-DEEuHbY5.js";import{H as ce,F as de}from"./Footer-C6GYhFVc.js";import{u as ve,M as pe,C as he}from"./useProducts-Da1UGPXH.js";const me={class:"catalog-page"},ge={class:"catalog-main"},fe={class:"container"},be={class:"search-container"},ke={class:"search-box"},Ce={key:0,class:"search-info"},ye={key:1,class:"loading"},_e={key:2,class:"error"},we={key:3},xe={class:"category-filters"},Pe=["onClick"],Me={key:0,class:"no-results"},Le={class:"no-results-text"},Se={class:"pagination-info"},ze={class:"pagination-stats"},Fe={class:"products-grid"},Ve={key:0,class:"pagination"},Be=["disabled"],Ee={class:"pagination-numbers"},Ie=["onClick"],Te={key:0,class:"pagination-ellipsis"},Ae=["disabled"],De={key:2,class:"no-products"},k=21,Ne={__name:"Catalog",setup(Ue){const C=re(),B=ue(),{loading:H,error:E,getFilteredProducts:Q,getAllCategories:G,reloadProducts:I}=ve(),T=G(),A=()=>{const e=C.query;return{filter:e.filter&&T.some(t=>t.id===e.filter)?e.filter:"all",page:e.page&&parseInt(e.page)>0?parseInt(e.page):1,search:e.search||""}},x=A(),r=m(x.filter),n=m(x.search),a=m(x.page),y=m(!1),P=m(null),M=m(!1),L=()=>{const e={};r.value!=="all"&&(e.filter=r.value),a.value!==1&&(e.page=String(a.value)),n.value&&(e.search=n.value),B.replace({query:e,hash:C.hash})};g(r,L),g(a,L),g(n,L),g([r,n],()=>{a.value=1});const K=(e,t)=>{if(!t||t.trim()==="")return e;const l=t.toLowerCase().trim();return e.filter(u=>{if(!u||typeof u!="object")return!1;const c=String(u.name||"").toLowerCase(),te=String(u.description||"").toLowerCase(),se=String(u.category||"").toLowerCase();return c.includes(l)||te.includes(l)||se.includes(l)})},d=h(()=>{let e=Q(r.value);return n.value.trim()&&(e=K(e,n.value)),e}),J=h(()=>{const e=(a.value-1)*k;return d.value.slice(e,e+k)}),v=h(()=>Math.ceil(d.value.length/k)),O=h(()=>(a.value-1)*k+1),W=h(()=>{const e=a.value*k;return e>d.value.length?d.value.length:e});g(v,e=>{a.value>e&&e>0&&(a.value=e)});const D=h(()=>{const t=[];if(v.value<=5){for(let c=1;c<=v.value;c++)t.push(c);return t}let l=Math.max(1,a.value-2),u=Math.min(v.value,l+5-1);u-l+1<5&&(l=Math.max(1,u-5+1));for(let c=l;c<=u;c++)t.push(c);return t}),X=h(()=>v.value>D.value.length);let S=null;const Y=()=>{clearTimeout(S),S=setTimeout(()=>{n.value.trim()&&r.value!=="all"&&(r.value="all")},300)},Z=e=>{r.value=e,n.value=""},z=()=>{n.value=""},F=e=>{M.value||e<1||e>v.value||(M.value=!0,a.value=e,requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>M.value=!1,400)}))},N=e=>{P.value=e,y.value=!0,document.body.style.overflow="hidden"},U=()=>{y.value=!1,P.value=null,document.body.style.overflow="auto"},$=e=>{e.key==="Escape"&&y.value&&U()},ee=()=>{r.value="all",n.value="",a.value=1,B.replace({name:C.name})};return g(()=>C.query,()=>{const e=A();r.value=e.filter,a.value=e.page,n.value=e.search}),ae(()=>{document.addEventListener("keydown",$)}),oe(()=>{document.removeEventListener("keydown",$),clearTimeout(S)}),(e,t)=>(o(),i("div",me,[q(ce),s("main",ge,[s("div",fe,[t[14]||(t[14]=s("h1",{class:"page-title"},"Каталог продукции",-1)),r.value!=="all"||n.value||a.value!==1?(o(),i("button",{key:0,onClick:ee,class:"reset-filters-btn"}," Сбросить все фильтры ")):f("",!0),s("div",be,[s("div",ke,[t[5]||(t[5]=s("svg",{class:"search-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[s("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1)),ne(s("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),type:"text",class:"search-input",placeholder:"Поиск товаров...",onInput:Y},null,544),[[ie,n.value]]),n.value?(o(),i("button",{key:0,onClick:z,class:"clear-search-btn",type:"button"},[...t[4]||(t[4]=[s("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[s("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])):f("",!0)]),n.value?(o(),i("div",Ce,[s("span",null,"Найдено товаров: "+p(d.value.length),1),s("button",{onClick:z,class:"clear-all-btn"}," Очистить поиск ")])):f("",!0)]),b(H)?(o(),i("div",ye,[...t[6]||(t[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Загрузка каталога...",-1)])])):b(E)?(o(),i("div",_e,[s("p",null,"Ошибка загрузки каталога: "+p(b(E)),1),s("button",{onClick:t[1]||(t[1]=(...l)=>b(I)&&b(I)(...l)),class:"retry-btn"},"Попробовать снова")])):(o(),i("div",we,[s("div",xe,[(o(!0),i(_,null,V(b(T),l=>(o(),i("button",{key:l.id,class:j(["filter-btn",{active:r.value===l.id}]),onClick:u=>Z(l.id)},p(l.name),11,Pe))),128))]),n.value&&d.value.length===0?(o(),i("div",Me,[t[9]||(t[9]=s("svg",{class:"no-results-icon",viewBox:"0 0 24 24",width:"48",height:"48"},[s("path",{fill:"#6b7280",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})],-1)),t[10]||(t[10]=s("p",{class:"no-results-title"},"Товары не найдены",-1)),s("p",Le,[w(' По запросу "'+p(n.value)+'" ничего не найдено. ',1),t[7]||(t[7]=s("br",null,null,-1)),t[8]||(t[8]=w("Попробуйте изменить поисковый запрос или выберите другую категорию. ",-1))]),s("button",{onClick:z,class:"back-to-catalog-btn"}," Вернуться к каталогу ")])):d.value.length>0?(o(),i(_,{key:1},[s("div",Se,[s("div",ze," Показано "+p(O.value)+"-"+p(W.value)+" из "+p(d.value.length)+" товаров ",1)]),s("div",Fe,[(o(!0),i(_,null,V(J.value,l=>(o(),R(he,{key:l.id,product:l,onDetailsClick:N,onCardClick:N},null,8,["product"]))),128))]),v.value>1?(o(),i("div",Ve,[s("button",{disabled:a.value===1,onClick:t[2]||(t[2]=l=>F(a.value-1)),class:"pagination-btn pagination-prev"},[...t[11]||(t[11]=[s("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[s("path",{fill:"currentColor",d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1),w(" Назад ",-1)])],8,Be),s("div",Ee,[(o(!0),i(_,null,V(D.value,l=>(o(),i("button",{key:l,onClick:u=>F(l),class:j(["pagination-number",{active:a.value===l}])},p(l),11,Ie))),128)),X.value?(o(),i("span",Te,"...")):f("",!0)]),s("button",{disabled:a.value===v.value,onClick:t[3]||(t[3]=l=>F(a.value+1)),class:"pagination-btn pagination-next"},[...t[12]||(t[12]=[w(" Вперед ",-1),s("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[s("path",{fill:"currentColor",d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])],8,Ae)])):f("",!0)],64)):(o(),i("div",De,[...t[13]||(t[13]=[s("p",null,"Товары в этой категории скоро появятся",-1)])]))]))])]),y.value?(o(),R(pe,{key:0,product:P.value,onClose:U},null,8,["product"])):f("",!0),q(de)]))}},je=le(Ne,[["__scopeId","data-v-bca8744d"]]);export{je as default};
